# Simple authorization for CakePHP [WIP]

This is very simple authorization plugin for CakePHP, it's using attributes for roles definition.

## Requirements

- CakePHP 4.x
- PHP 8.x
- Configured Authentication (check CakePHP documentation)

## Installation

You can install this plugin into your CakePHP application using [composer](https://getcomposer.org).

The recommended way to install composer packages is:

```bash
composer require maymeow/cake-authorization
```

load plugin to the CakePHP `Application.php`

```bash
$this->addPlugin('MayMeow/Authorization');
```

load it in controller

```php
public function initialize(): void
{
    parent::initialize(); // TODO: Change the autogenerated stub

    $this->loadComponent('MayMeow/Authorization.Authorization');
}
```

and run it

```php
public function beforeFilter(EventInterface $event)
{
    parent::beforeFilter($event); // TODO: Change the autogenerated stub

    $this->Authorization->authorize($this);
}
```

## Simple Authorization

This is just simple checking if identity attribute exists. This function will be probably removed because simple authorization is provided by Authentication plugin.

It can be used as annotate on functions that they need the user is logged-in.

```php
#[Authorize]
public function index()
{
    $users = $this->paginate($this->Users);

    $this->set(compact('users'));
}
```

## Role-based authorization

It is checking if user has provided roles. Entity that storing users must implement
`\MayMeow\Authorization\Controller\Component\RoleAuthorizationInterface`, it must return

**Limitations**: User can have assigned only one Role

```php
#[Authorize('Administrators')]
public function view($id = null)
{
    $user = $this->Users->get($id, [
        'contain' => [],
    ]);

    $this->set(compact('user'));
}
```

You can also provide more roles by entering names and separate them with coma `,`. Don't use any spaces.

```php
#[Authorize('Administrators,Users')]
public function view($id = null)
{
    $user = $this->Users->get($id, [
        'contain' => [],
    ]);

    $this->set(compact('user'));
}
```

If you're using role based authorization, all roles for which you want to have access to the actions must be provided.

## Policy based authorization

Using some predefined policies to authorize users like username or required role.

You can check for role by role based but also with policy based authoriaztion as follows

```php
#[Authorize(policy: Policy::requireRole, options: 'administrator')]
public function view($id = null)
{
    $user = $this->Users->get($id, [
        'contain' => [],
    ]);

    $this->set(compact('user'));
}
```

If you want to authorize user by username you can use RequiresUsername policy.

```php
#[Authorize(policy: Policy::requireUserName, options: 'email@address.tld')]
public function view($id = null)
{
    $user = $this->Users->get($id, [
        'contain' => [],
    ]);

    $this->set(compact('user'));
}
```

## Contribute

For contibuting guide please check https://github.com/MayMeow/contribution
