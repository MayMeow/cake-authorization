# Simple authorization for CakePHP [WIP]

This is very simple authorization plugin for CakePHP, it's using attributes for roles definition.

## Requirements

- CakePHP 4.x
- PHP 8.x
- Configured Authentication (check CakePHP documentation)

## Installation

You can install this plugin into your CakePHP application using [composer](https://getcomposer.org).

The recommended way to install composer packages is:

```bash
composer require may-meow/authorization
```

load plugin to the CakePHP app

```bash
php bin/cake.php plugin load Authorization
```

load it in controller

```php
public function initialize(): void
{
    parent::initialize(); // TODO: Change the autogenerated stub

    $this->loadComponent('MayMeow/Authorization.Authorization');
}
```

and run it

```php
public function beforeFilter(EventInterface $event)
{
    parent::beforeFilter($event); // TODO: Change the autogenerated stub

    $this->Authorization->authorize($this);
}
```

## Simple Authorization

This is just simple checking if identity attribute exists. This function will be probably removed because simple authorization is provided by Authentication plugin.

It can be used as annotate on functions that they need the user is logged-in.

```php
#[Authorize]
public function index()
{
    $users = $this->paginate($this->Users);

    $this->set(compact('users'));
}
```

## Role-based authorization

It is checking if user has provided roles. Entity that storing users must implement
`\MayMeow\Authorization\Controller\Component\RoleAuthorizationInterface`, it must return

**Limitations**: User can have assigned only one Role

```php
#[Authorize('Administrators')]
public function view($id = null)
{
    $user = $this->Users->get($id, [
        'contain' => [],
    ]);

    $this->set(compact('user'));
}
```

You can also provide more roles by entering names and separate them with coma `,`. Don't use any spaces.

```php
#[Authorize('Administrators,Users')]
public function view($id = null)
{
    $user = $this->Users->get($id, [
        'contain' => [],
    ]);

    $this->set(compact('user'));
}
```

If you're using role based authorization, all roles for which you want to have access to the actions must be provided.

## UserName based authorization

You can also authorize access to certain methods only for some users as in example bellow (username in example is
his email)

```php
#[Authorize(user: 'user@email.tld')]
#[Route('/users/edit/*')]
public function edit($id = null)
{
    $user = $this->Users->get($id, [
        'contain' => [],
    ]);
}
```

As in groups you can also add more usernames separated by `,` coma.

:warning: It is important to enable email verification if you are using this method. And if you are using usernames add those
to the list of prohibited names so no one can use those names during registration process.

### Combination of Role based and User based authorization

In some situation you want to authorize users based on roles and some users on their names.

```php
#[Authorize(role: 'Administrators,Finance', user: 'superadmin@mail.tld')]
#[Route('/users/add')]
public function add()
{
    $user = $this->Users->newEmptyEntity();
}
```

In this case if users hasRole that are in allowed roles or has email from list of allowed emails then
authorization is passed and that user is allowed to preform requested action.

## Resource based authorization

Work in progress. Entity which need to be authorized must implement
`\MayMeow\Authorization\Controller\Component\ResourceAuthorizationInterface`, it must return identifier of author.

## Contribute

For contibuting guide please check https://github.com/MayMeow/contribution
